# How to Write and Publish the Report

## Writing the Report

The [Jupyter Book](https://jupyterbook.org/intro.html) website goes into
extensive detail on how to set up a fresh book folder structure and populate it
with text.

### Citations

Citations and bibliographies [are covered in the Jupyter Book docs](https://jupyterbook.org/content/citations.html#citations-and-bibliographies).

#### Bibliography

To add a bibliography at the end of the document that's included in the ToC,
follow the first four steps [here](https://jupyterbook.org/content/citations.html#citations-and-bibliographies),
then create a file, `biblio.md`, with the contents:

````md
# Bibliography

```{bibliography}
```
````

and add it to `_toc.yml`. The header is needed to include the page in the ToC.

### Making Figures

#### Plotly Plots

Following this [useful discussion](https://github.com/executablebooks/jupyter-book/issues/93), we can embed Plotly
HTML outputs generated by Jupyter notebooks in the HTML build of the report. For
example, to embed a scatter plot, we insert this code into a notebook cell 
(make sure to make an `images/` folder first):

```
import plotly.graph_objects as go
import plotly.offline as ploff
from IPython.core.display import display, HTML

# Create a figure.
fig = go.Figure()
fig.add_trace(go.Scatter(
    x=[1, 2, 3],
    y=[1, 1.4, 1.7],
    mode="markers"))

# Dump the figure as HTML in the images/ subfolder.
ploff.plot(fig, filename='images/testplot.html')
# Use the HTML display engine to render the figure.
display(HTML('images/testplot.html'))
```

When interactively running the notebook, this code will not plot the figure in
the notebook. When Jupyter Book runs the notebook to build the docs, however,
the plot *will* be included.

Note that all Plotly plots save data (and possibly private keys and passwords)
in plain text in the HTML, so do *not* use this method to store data that
shouldn't be public!

## Publishing the Report

### Building HTML

To build HTML, go to the `midblockped` directory, and run:

```
jupyter-book build ./
```

This will generate HTML in `midblockped/_build` directory, which can be opened
in your browser of choice.

### Publishing to GitHub Pages

Following [this tutorial](https://jupyterbook.org/publish/gh-pages.html#push-your-book-to-a-branch-hosted-by-github-pages):

1. Navigate to the `midblockped` directory.
2. Run the command
   ```
   ghp-import -n -p -f _build/html
   ```
3. Check on the [repo settings
   page](https://github.com/Toronto-Big-Data-Innovation-Team/vz_midblockped_paper/settings)
   that the Source is `gh-pages`, and the folder is `/(root)` (not sure how to
   even use the `docs` option).
4. Check that the [published
   site](https://toronto-big-data-innovation-team.github.io/vz_midblockped_paper/landing-page.html)
   is active and updated.
